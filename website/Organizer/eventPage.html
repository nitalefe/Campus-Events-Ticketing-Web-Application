<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Event Details</title>
  <link rel="icon" type="image/png" href="../../assets/images/evently_logo_DT.png">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Montserrat', Arial, sans-serif;
      background: linear-gradient(135deg, #367bfc 0%, #002976 100%);
      margin: 0; padding: 0;
    }
    .toolbar {
      width: 100%;
      background: rgba(0,51,102,0.95);
      color: #fff;
      display: flex;
      align-items: center;
      padding: 0 2vw;
      height: clamp(60px, 8vh, 72px);
      box-sizing: border-box;
      box-shadow: 0 0.3vh 1vh rgba(0,0,0,0.12);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .toolbar-logo {
      height: clamp(40px, 6vh, 48px);
      margin-right: clamp(20px, 3vw, 36px);
      cursor: pointer;
      filter: drop-shadow(0 0.2vh 0.3vh rgba(0,0,0,0.18));
      transition: transform 0.2s;
    }
    .toolbar-logo:hover {
      transform: scale(1.08) rotate(-2deg);
    }
    .toolbar-btn { 
      background: rgba(255,255,255,0.08); 
      border: none; 
      color: #fff; 
      font-size: clamp(0.9rem, 2.5vw, 1.08rem);
      margin-right: clamp(16px, 2.5vw, 24px);
      cursor: pointer;
      padding: clamp(8px, 1.5vh, 10px) clamp(16px, 3vw, 22px);
      border-radius: 0.4vw;
      font-family: 'Montserrat', Arial, sans-serif;
      font-weight: 400;
      letter-spacing: 0.5px;
      transition: background 0.2s, box-shadow 0.2s;
      box-shadow: 0 0.2vh 0.6vh rgba(0,0,0,0.04);
      white-space: nowrap;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    .toolbar-btn:hover {
      background: #367bfc;
      box-shadow: 0 0.3vh 0.9vh rgba(54,123,252,0.18);
    }
    .toolbar-spacer { flex: 1; }
    .auth-btn {
      background: linear-gradient(90deg, #6fa3ef 60%, #367bfc 100%);
      color: #fff;
      border: none;
      border-radius: 0.4vw;
      font-size: clamp(0.9rem, 2.2vw, 1rem);
      cursor: pointer;
      padding: clamp(8px, 1.5vh, 10px) clamp(16px, 3vw, 22px);
      font-weight: 600;
      box-shadow: 0 0.2vh 0.6vh rgba(54,123,252,0.12);
      transition: background 0.2s, box-shadow 0.2s;
    }
    .auth-btn:hover {
      background: linear-gradient(90deg, #a3c8f7 60%, #367bfc 100%);
      box-shadow: 0 0.3vh 0.9vh rgba(54,123,252,0.22);
    }
    .container { max-width: 900px; margin: 48px auto; background: #fff; border-radius: 12px; padding: 36px; box-shadow: 0 8px 24px rgba(0,0,0,0.1); }
    .event-image { width: 100%; height: 340px; object-fit: cover; border-radius: 12px; margin-bottom: 24px; }
    .event-title { font-size: 2em; color: #002976; margin-bottom: 12px; }
    .event-date-location { color: #367bfc; font-size: 1.1em; margin-bottom: 16px; }
    .event-description { font-size: 1.05em; color: #333; background: rgba(54,123,252,0.05); padding: 16px; border-radius: 8px; }
    .buy-ticket-btn { background: linear-gradient(90deg, #0078d4 60%, #367bfc 100%); color: #fff; border: none; border-radius: 8px; padding: 14px 28px; font-size: 1.1em; cursor: pointer; margin-top: 20px; margin-right: 12px; }
    
    /* Mobile responsive adjustments for toolbar */
    @media (max-width: 768px) {
      .toolbar {
        padding: 0 1vw;
        height: clamp(50px, 6vh, 60px);
      }
      
      .toolbar-logo {
        height: clamp(32px, 5vh, 40px);
        margin-right: clamp(12px, 2vw, 20px);
      }
      
      .toolbar-btn {
        font-size: clamp(0.8rem, 2vw, 0.9rem);
        padding: clamp(6px, 1vh, 8px) clamp(12px, 2.5vw, 16px);
        margin-right: clamp(8px, 1.5vw, 16px);
      }
      
      .auth-btn {
        font-size: clamp(0.8rem, 2vw, 0.9rem);
        padding: clamp(6px, 1vh, 8px) clamp(12px, 2.5vw, 16px);
      }
    }
  </style>
</head>
<body>

  <div class="toolbar">
<img src="../../assets/images/evently_logo_DT.png" alt="Evently Logo" class="toolbar-logo" onclick="location.href='organizer-dashboard.html'">

    <button class="toolbar-btn" onclick="location.href='organizer-dashboard.html'">Home</button>
    <button class="toolbar-btn" onclick="location.href='eventCreation.html'">Create New Event</button>
    <div class="toolbar-spacer"></div>
    <button class="toolbar-btn" onclick="location.href='settings.html'">Settings</button>
    <div id="authBtnContainer">
      <button id="logout-btn" class="auth-btn">Log Out</button>
    </div>
  </div>

  <div class="container">
    <img id="eventBanner" src="https://via.placeholder.com/900x340" class="event-image" alt="Event Banner">
    <h1 class="event-title">Loading...</h1>
    <div class="event-date-location"></div>
    <div class="event-description">Loading event details...</div>
   <button class="buy-ticket-btn" onclick="location.href='eventEdit.html?id=' + new URLSearchParams(window.location.search).get('id')">
  Edit Event
</button>
    <button class="buy-ticket-btn" onclick="location.href='scanTicket.html'">Scan Ticket</button>
    <button class="buy-ticket-btn" onclick="location.href='EventDashboard.html'">View Analytics</button>
  </div>

  <!-- Firebase + Auth -->
  <script type="module" src="../../Shared/firebase-config.js"></script>
  <script type="module" src="../../js/Registration/auth.js"></script>

  <!-- Load Event Details -->
  <script type="module">
  import { auth, db } from "../../Shared/firebase-config.js";
  import { doc, getDoc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";
  import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";

  const params = new URLSearchParams(window.location.search);
  const eventId = params.get("id");

  const titleEl = document.querySelector(".event-title");
  const descEl = document.querySelector(".event-description");
  const dateLocEl = document.querySelector(".event-date-location");
  const bannerEl = document.getElementById("eventBanner");

  const editBtn = document.querySelector('.buy-ticket-btn:nth-of-type(1)');
  const scanBtn = document.querySelector('.buy-ticket-btn:nth-of-type(2)');
  const analyticsBtn = document.querySelector('.buy-ticket-btn:nth-of-type(3)');

  async function loadEventDetails(user) {
    if (!eventId) {
      titleEl.textContent = "Event not found.";
      return;
    }

    const docRef = doc(db, "events", eventId);
    const snap = await getDoc(docRef);

    if (!snap.exists()) {
      titleEl.textContent = "Event not found.";
      descEl.textContent = "";
      return;
    }

    const data = snap.data();
    titleEl.textContent = data.eventName || "Untitled Event";
    descEl.innerHTML = data.eventDescription || "No description available.";

    const dateObj = data.eventDateTime?.toDate?.();
    const dateStr = dateObj ? dateObj.toDateString() : "Unknown date";
    dateLocEl.innerHTML = `
      <span>${dateStr}</span><br>
      <span>${data.eventLocation || "Unknown location"}</span>
    `;

    // Load event banner from Firebase
    if (data.banner) {
      bannerEl.src = data.banner;
      bannerEl.alt = `${data.eventName} Banner`;
    } else {
      // Fallback to placeholder if no banner is set
      bannerEl.src = "https://via.placeholder.com/900x340";
      bannerEl.alt = "Event Banner";
    }

    // ðŸš« Hide organizer-only buttons if not owner
    if (!user || user.uid !== data.createdBy) {
      editBtn.style.display = "none";
      scanBtn.style.display = "none";
      analyticsBtn.style.display = "none";
    } else {
      // âœ… Organizer can edit, scan, view analytics
      editBtn.onclick = () => location.href = `eventEdit.html?id=${eventId}`;
      scanBtn.onclick = () => location.href = `qrScanner.html?id=${eventId}`;
      analyticsBtn.onclick = () => location.href = `EventDashboard.html?id=${eventId}`;
    }
  }

  // Wait for auth to load, then fetch event
  onAuthStateChanged(auth, (user) => {
    loadEventDetails(user);
  });
</script>


</body>
</html>
