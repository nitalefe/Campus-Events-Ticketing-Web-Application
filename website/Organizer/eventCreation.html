<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Create Event</title>
  <link rel="icon" type="image/png" href="../../assets/images/evently_logo_DT.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../../css/Organizer/eventCreation.css">
  <link rel="stylesheet" href="../../css/Shared/toolbar.css">
</head>

<body>
  <!-- Toolbar -->
  <div class="toolbar">
    <img src="../../assets/images/evently_logo_DT.png" alt="Evently Logo" class="toolbar-logo"
      onclick="location.href='organizer-dashboard.html'">

    <button class="toolbar-btn" onclick="location.href='organizer-dashboard.html'">Home</button>
    <button class="toolbar-btn" onclick="location.href='eventCreation.html'">Create New Event</button>
    <button class="toolbar-btn" onclick="location.href='myEvents.html'">My Events</button>
    <button class="toolbar-btn" onclick="location.href='broadcast.html'">Broadcast</button>
    <button class="toolbar-btn" onclick="location.href='../Shared_Pages/inbox.html'">Inbox</button>
    <div class="toolbar-spacer"></div>
    <button class="toolbar-btn" onclick="location.href='../Profile/profile.html'">Profile</button>
    <div id="authBtnContainer">
      <button id="logout-btn" class="auth-btn">Log Out</button>
    </div>
  </div>

  <!-- Event Creation Form -->
  <div class="container">
    <div class="card">
      <h2>Create New Event</h2>
      <div class="form-grid">
        <div class="preview-card">
          <div class="preview-banner" id="previewBannerWrap">
            <img id="previewImage" src="../../assets/images/event1.jpeg" alt="Banner Preview">
          </div>
          <div class="preview-content">
            <h3 id="previewTitle">Event Title</h3>
            <div id="previewDateLoc" class="preview-meta">Date · Location</div>
            <p id="previewDesc" class="preview-desc">Short description will appear here as you type.</p>
            <div class="preview-actions">
              <button class="btn btn-primary" disabled>Buy Tickets</button>
              <button class="btn btn-secondary" disabled>More Info</button>
            </div>
          </div>
        </div>

        <div>
          <form id="eventForm">
            <div class="field-group">
              <label for="eventName">Event Name</label>
              <input type="text" id="eventName" name="eventName" required>
            </div>

            <div class="field-group">
              <label for="eventDescription">Description</label>
              <textarea id="eventDescription" name="eventDescription" rows="4" required></textarea>
            </div>

            <div class="field-group">
              <label for="eventBanner">Event Banner</label>
              <select id="eventBanner" name="eventBanner" required onchange="previewBanner()">
                <option value="">Select Banner Image</option>
                <option value="../../assets/images/event1.jpeg">Event Banner 1</option>
                <option value="../../assets/images/event2.jpg">Event Banner 2</option>
                <option value="../../assets/images/event3.jpeg">Event Banner 3</option>
                <option value="../../assets/images/event4.jpeg">Event Banner 4</option>
                <option value="../../assets/images/event5.jpg">Event Banner 5</option>
                <option value="../../assets/images/event6.jpg">Event Banner 6</option>
                <option value="../../assets/images/event7.jpg">Event Banner 7</option>
                <option value="../../assets/images/event8.jpg">Event Banner 8</option>
                <option value="../../assets/images/event9.jpg">Event Banner 9</option>
                <option value="../../assets/images/event10.jpg">Event Banner 10</option>
              </select>
            </div>

            <div class="field-group">
              <label for="eventDate">Date</label>
              <input type="date" id="eventDate" name="eventDate" required>
            </div>

            <div class="field-group">
              <label for="eventTime">Time</label>
              <input type="time" id="eventTime" name="eventTime" required>
            </div>

            <div class="field-group">
              <label for="eventLocation">Location</label>
              <input type="text" id="eventLocation" name="eventLocation" required>
            </div>

            <div class="field-group">
              <label for="eventCategory">Category</label>
              <select id="eventCategory" name="eventCategory" required>
                <option value="">Select Category</option>
                <option value="Workshop">Workshop</option>
                <option value="Seminar">Seminar</option>
                <option value="Concert">Concert</option>
                <option value="Sports">Sports</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <div class="field-group">
              <label for="openTo">Open to <small>(optional, select multiple)</small></label>
              <select id="openTo" name="openTo" multiple size="6">
                <option value="Concordia">Concordia University</option>
                <option value="McGill">McGill University</option>
                <option value="UdeM">Université de Montréal</option>
                <option value="Polytechnique">Polytechnique Montréal</option>
                <option value="HEC">HEC Montréal</option>
                <option value="UQAM">UQAM</option>
              </select>
              <small>Hold Ctrl (Windows) or Command (Mac) to select multiple universities.</small>
            </div>

            <div class="field-group">
              <label for="capacity">Number of Tickets</label>
              <input type="number" id="capacity" name="capacity" min="1" required>
            </div>

            <div class="field-group">
              <label for="ticketPrice">Ticket Price ($)</label>
              <input type="number" id="ticketPrice" name="ticketPrice" min="0" step="0.01" required>
            </div>

            <div class="form-actions">
              <button type="submit" class="btn btn-primary">Create Event</button>
              <button type="button" class="btn btn-secondary"
                onclick="location.href='organizer-dashboard.html'">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Banner Preview Script + Live Preview Wiring -->
  <script>
    function previewBanner() {
      const bannerSelect = document.getElementById('eventBanner');
      const previewImage = document.getElementById('previewImage');
      const setError = (msg) => {
        previewImage.style.display = 'none';
      };

      if (bannerSelect && bannerSelect.value) {
        previewImage.src = bannerSelect.value;
        previewImage.style.display = 'block';
        previewImage.onerror = () => setError('Error loading banner preview');
      } else {
        previewImage.style.display = 'none';
      }
    }

    function updatePreview() {
      const title = document.getElementById('eventName').value || 'Event Title';
      const desc = document.getElementById('eventDescription').value || 'Short description will appear here as you type.';
      const date = document.getElementById('eventDate').value;
      const time = document.getElementById('eventTime').value;
      const loc = document.getElementById('eventLocation').value || 'Location';
      const previewTitle = document.getElementById('previewTitle');
      const previewDesc = document.getElementById('previewDesc');
      const previewDateLoc = document.getElementById('previewDateLoc');
      const bannerSelect = document.getElementById('eventBanner');
      const previewImage = document.getElementById('previewImage');

      previewTitle.textContent = title;
      previewDesc.textContent = desc.length > 220 ? desc.slice(0, 217) + '...' : desc;
      let dateText = '';
      if (date) { try { dateText = new Date(date).toDateString(); } catch (e) { dateText = date; } }
      const timeText = time ? time : '';
      previewDateLoc.textContent = [dateText, timeText, loc].filter(Boolean).join(' · ');

      if (bannerSelect && bannerSelect.value) { previewImage.src = bannerSelect.value; previewImage.style.display = 'block'; }
    }

    document.addEventListener('DOMContentLoaded', () => {
      const bannerSelect = document.getElementById('eventBanner');
      if (bannerSelect && bannerSelect.value) previewBanner();
      const inputsToPreview = ['eventName', 'eventDescription', 'eventDate', 'eventTime', 'eventLocation'];
      inputsToPreview.forEach(id => {
        const el = document.getElementById(id);
        if (!el) return;
        el.addEventListener('input', updatePreview);
        el.addEventListener('change', updatePreview);
      });
      updatePreview();
    });
  </script>

  <!-- Firebase Scripts -->
  <script type="module" src="../../js/Registration/auth.js"></script>
  <script type="module" src="../../js/Events/events.js"></script>
</body>

</html>