<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Edit Event</title>
  <link rel="icon" type="image/png" href="../../assets/images/evently_logo_DT.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #367bfc 0%, #002976 100%);
      font-family: 'Montserrat', Arial, sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }

    /* Toolbar */
    .toolbar {
      width: 100%;
      background: rgba(0,51,102,0.95);
      color: #fff;
      display: flex;
      align-items: center;
      padding: 0 2vw;
      height: clamp(60px, 8vh, 72px);
      box-sizing: border-box;
      box-shadow: 0 0.3vh 1vh rgba(0,0,0,0.12);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .toolbar-logo {
      height: clamp(40px, 6vh, 48px);
      margin-right: clamp(20px, 3vw, 36px);
      cursor: pointer;
      filter: drop-shadow(0 0.2vh 0.3vh rgba(0,0,0,0.18));
      transition: transform 0.2s;
    }
    .toolbar-logo:hover {
      transform: scale(1.08) rotate(-2deg);
    }
    .toolbar-btn {
      background: rgba(255,255,255,0.08);
      border: none;
      color: #fff;
      font-size: clamp(0.9rem, 2.5vw, 1.08rem);
      margin-right: clamp(16px, 2.5vw, 24px);
      cursor: pointer;
      padding: clamp(8px, 1.5vh, 10px) clamp(16px, 3vw, 22px);
      border-radius: 0.4vw;
      font-family: 'Montserrat', Arial, sans-serif;
      font-weight: 400;
      letter-spacing: 0.5px;
      transition: background 0.2s, box-shadow 0.2s;
      box-shadow: 0 0.2vh 0.6vh rgba(0,0,0,0.04);
      white-space: nowrap;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    .toolbar-btn:hover {
      background: #367bfc;
      box-shadow: 0 4px 12px rgba(54,123,252,0.18);
    }
    .toolbar-spacer { flex: 1; }
    .auth-btn {
      background: linear-gradient(90deg, #6fa3ef 60%, #367bfc 100%);
      color: #fff;
      border: none;
      border-radius: 0.4vw;
      font-size: clamp(0.9rem, 2.2vw, 1rem);
      cursor: pointer;
      padding: clamp(8px, 1.5vh, 10px) clamp(16px, 3vw, 22px);
      font-weight: 600;
      box-shadow: 0 0.2vh 0.6vh rgba(54,123,252,0.12);
      transition: background 0.2s, box-shadow 0.2s;
    }
    .auth-btn:hover {
      background: linear-gradient(90deg, #a3c8f7 60%, #367bfc 100%);
      box-shadow: 0 0.3vh 0.9vh rgba(54,123,252,0.22);
    }

    /* Form Container + Card Layout */
    .container {
      max-width: clamp(320px, 92vw, 1100px);
      margin: clamp(20px, 4vh, 48px) auto;
      color: #222;
      padding: 0 1vw;
    }

    .card {
      background: rgba(255,255,255,0.98);
      border-radius: clamp(10px, 1.5vw, 18px);
      padding: clamp(18px, 3.5vh, 40px);
      box-shadow: 0 clamp(6px, 1.2vh, 16px) clamp(24px, 4vw, 40px) rgba(54,123,252,0.08);
      border: 1px solid rgba(0,0,0,0.03);
    }

    h2 {
      text-align: left;
      margin: 0 0 clamp(8px, 2vh, 20px) 0;
      font-size: clamp(1.4rem, 4vw, 2rem);
      font-weight: 700;
      color: #002976;
    }

    /* Grid: preview (left) + fields (right) */
    .form-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: clamp(12px, 2.5vh, 24px);
    }

    /* larger screens: two columns */
    @media (min-width: 900px) {
      .form-grid { grid-template-columns: 40% 60%; align-items: start; }
    }

    .preview-card {
      background: linear-gradient(180deg, #ffffff, #f7fbff);
      padding: clamp(12px, 2vh, 18px);
      border-radius: clamp(8px, 1.2vw, 12px);
      text-align: center;
      box-shadow: 0 clamp(4px, 0.8vh, 8px) clamp(12px, 2vw, 16px) rgba(0,0,0,0.06);
      border: 1px solid rgba(54,123,252,0.03);
    }

    #previewImage {
      width: 100%;
      height: auto;
      max-height: clamp(140px, 28vh, 300px);
      object-fit: cover;
      border-radius: clamp(6px, 1vw, 10px);
      display: block;
      margin: 0 auto clamp(8px, 1.5vh, 12px);
      box-shadow: 0 clamp(2px, 0.4vh, 6px) rgba(0,0,0,0.08);
    }

    /* Preview specifics */
    .preview-banner { overflow: hidden; border-radius: clamp(6px, 1vw, 10px); }
  .preview-content { text-align: left; padding-top: clamp(10px, 2vh, 12px); /* allow long words to wrap inside the preview */ overflow-wrap: break-word; word-wrap: break-word; word-break: break-word; hyphens: auto; }
  .preview-content #previewTitle { font-size: clamp(1rem, 2.6vw, 1.2rem); margin: 0 0 clamp(6px, 1vh, 10px); color: #002976; font-weight: 700; white-space: normal; overflow-wrap: anywhere; word-break: break-word; }
  .preview-meta { color: #367bfc; font-size: clamp(0.85rem, 2.1vw, 0.95rem); margin-bottom: clamp(8px, 1.5vh, 12px); white-space: normal; overflow-wrap: anywhere; word-break: break-word; }
  .preview-desc { color: #444; font-size: clamp(0.9rem, 2vw, 1rem); margin-bottom: clamp(10px, 1.8vh, 14px); white-space: normal; overflow-wrap: anywhere; word-break: break-word; }
    .preview-actions { display:flex; gap:8px; }

    .field-group { margin-bottom: clamp(8px, 2vh, 14px); }
    label { display: block; margin-bottom: clamp(6px, 1vh, 10px); color: #222; font-weight: 600; }
    input, textarea, select { width: 100%; padding: clamp(10px, 2vh, 14px); border: 1px solid #e6e9ef; border-radius: 8px; font-size: clamp(0.9rem, 2.2vw, 1.05rem); background: #fff; box-sizing: border-box; }
    input:focus, textarea:focus, select:focus { outline: none; border-color: #6fa3ef; box-shadow: 0 0 0 3px rgba(111,163,239,0.12); }
    textarea { min-height: clamp(80px, 18vh, 140px); resize: vertical; }

    .form-actions { display: flex; gap: clamp(8px, 2vw, 12px); margin-top: clamp(12px, 2.5vh, 20px); flex-wrap: wrap; }
    .btn { padding: clamp(10px, 2vh, 14px) clamp(16px, 3.5vw, 24px); border-radius: 8px; border: none; cursor: pointer; font-weight: 600; }
    .btn-primary { background: linear-gradient(90deg, #6fa3ef 60%, #367bfc 100%); color: #fff; box-shadow: 0 6px 20px rgba(54,123,252,0.12); }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 28px rgba(54,123,252,0.14); }
    .btn-secondary { background: transparent; color: #002976; border: 1px solid rgba(0,41,118,0.08); }

    small { color:#666; display:block; margin-top: 6px; }
    
    /* Mobile responsive adjustments */
    @media (max-width: 768px) {
      .toolbar { padding: 0 1vw; height: clamp(50px, 6vh, 60px); }
      .toolbar-logo { height: clamp(32px, 5vh, 40px); margin-right: clamp(12px, 2vw, 20px); }
      .toolbar-btn { font-size: clamp(0.8rem, 2vw, 0.9rem); padding: clamp(6px, 1vh, 8px) clamp(12px, 2.5vw, 16px); margin-right: clamp(8px, 1.5vw, 16px); }
      .auth-btn { font-size: clamp(0.8rem, 2vw, 0.9rem); padding: clamp(6px, 1vh, 8px) clamp(12px, 2.5vw, 16px); }
      .container { margin: clamp(14px, 3vh, 20px) auto; padding: 0 1vw; }
      .card { padding: clamp(14px, 3vh, 20px); }
      h2 { font-size: clamp(1.2rem, 4vw, 1.6rem); }
      .preview-card { padding: clamp(10px, 2vh, 12px); }
      #previewImage { max-height: clamp(120px, 24vh, 200px); }
      .form-actions { flex-direction: column-reverse; }
      .btn { width: 100%; }
    }
  </style>
</head>
<body>

  <!-- Toolbar -->
  <div class="toolbar">
  <img src="../../assets/images/evently_logo_DT.png" alt="Evently Logo" class="toolbar-logo" onclick="location.href='organizer-dashboard.html'">

    <button class="toolbar-btn" onclick="location.href='organizer-dashboard.html'">Home</button>
    <button class="toolbar-btn" onclick="location.href='eventCreation.html'">Create New Event</button>
    <div class="toolbar-spacer"></div>
    <button class="toolbar-btn" onclick="location.href='settings.html'">Settings</button>
    <div id="authBtnContainer">
      <button id="logout-btn" class="auth-btn">Log Out</button>
    </div>
  </div>

  <!-- Edit Event Form -->
  <div class="container">
    <div class="card">
      <h2>Edit Event</h2>
      <div class="form-grid">
        <div class="preview-card">
          <!-- Full event page mock preview -->
          <div class="preview-banner" id="previewBannerWrap">
  <img id="previewImage" src="../../assets/images/event1.jpeg" alt="Banner Preview">
  <div id="previewText" style="display:none; color:#888; margin-top:8px; font-size:0.9rem;">
    Select a banner to see preview
  </div>
</div>
          <div class="preview-content">
            <h3 id="previewTitle">Event Title</h3>
            <div id="previewDateLoc" class="preview-meta">Date Â· Location</div>
            <p id="previewDesc" class="preview-desc">Short description will appear here as you type. This is a condensed preview of the event description.</p>
            <div class="preview-actions">
              <button class="btn btn-primary" disabled>Buy Tickets</button>
              <button class="btn btn-secondary" disabled>More Info</button>
            </div>
          </div>
        </div>

        <div>
          <form id="eventForm">
            <div class="field-group">
              <label for="eventName">Event Name</label>
              <input type="text" id="eventName" name="eventName" required>
            </div>

            <div class="field-group">
              <label for="eventDescription">Description</label>
              <textarea id="eventDescription" name="eventDescription" rows="4" required></textarea>
            </div>

            <div class="field-group">
              <label for="eventBanner">Event Banner</label>
              <select id="eventBanner" name="eventBanner" required onchange="previewBanner()">
                <option value="">Select Banner Image</option>
                <option value="../../assets/images/event1.jpeg">Event Banner 1</option>
                <option value="../../assets/images/event2.jpg">Event Banner 2</option>
                <option value="../../assets/images/event3.jpeg">Event Banner 3</option>
                <option value="../../assets/images/event4.jpeg">Event Banner 4</option>
                <option value="../../assets/images/event5.jpg">Event Banner 5</option>
                <option value="../../assets/images/event6.jpg">Event Banner 6</option>
                <option value="../../assets/images/event7.jpg">Event Banner 7</option>
                <option value="../../assets/images/event8.jpg">Event Banner 8</option>
                <option value="../../assets/images/event9.jpg">Event Banner 9</option>
                <option value="../../assets/images/event10.jpg">Event Banner 10</option>
              </select>
            </div>

            <div class="field-group">
              <label for="eventDate">Date</label>
              <input type="date" id="eventDate" name="eventDate" required>
            </div>

            <div class="field-group">
              <label for="eventTime">Time</label>
              <input type="time" id="eventTime" name="eventTime" required>
            </div>

            <div class="field-group">
              <label for="eventLocation">Location</label>
              <input type="text" id="eventLocation" name="eventLocation" required>
            </div>

            <div class="field-group">
              <label for="eventCategory">Category</label>
              <select id="eventCategory" name="eventCategory" required>
                <option value="">Select Category</option>
                <option value="Workshop">Workshop</option>
                <option value="Seminar">Seminar</option>
                <option value="Concert">Concert</option>
                <option value="Sports">Sports</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <div class="field-group">
              <label for="capacity">Number of Tickets</label>
              <input type="number" id="capacity" name="capacity" min="1" required>
            </div>

            <div class="field-group">
              <label for="ticketPrice">Ticket Price ($)</label>
              <input type="number" id="ticketPrice" name="ticketPrice" min="0" step="0.01" required>
            </div>

            <div class="form-actions">
              <button type="submit" class="btn btn-primary">Save Changes</button>
              <button type="button" class="btn btn-secondary" onclick="location.href='organizer-dashboard.html'">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Banner Preview Script -->
  <script>
    function previewBanner() {
      const bannerSelect = document.getElementById('eventBanner');
      const previewImage = document.getElementById('previewImage');
      const previewText = document.getElementById('previewText');

      const setError = (msg) => {
        previewImage.style.display = 'none';
        previewText.textContent = msg;
        previewText.style.display = 'block';
        previewText.style.color = '#e74c3c';
      };

      if (bannerSelect && bannerSelect.value) {
        previewText.style.display = 'none';
        previewImage.style.display = 'block';
        previewImage.src = bannerSelect.value;

        previewImage.onerror = function() {
          setError('Error loading banner preview');
        };

        previewImage.onload = function() {
          previewText.style.color = '#888';
          previewText.style.display = 'none';
          previewImage.style.display = 'block';
        };
      } else {
        previewImage.style.display = 'none';
        previewText.textContent = 'Select a banner to see preview';
        previewText.style.display = 'block';
        previewText.style.color = '#888';
      }
    }

    // Initialize preview if editing an existing event (or keep default state)
    document.addEventListener('DOMContentLoaded', () => {
      const bannerSelect = document.getElementById('eventBanner');
      // if a value is preset (e.g., from script) preview it
      if (bannerSelect && bannerSelect.value) previewBanner();
      // wire inputs to preview live
      const inputsToPreview = ['eventName','eventDescription','eventDate','eventTime','eventLocation'];
      inputsToPreview.forEach(id => {
        const el = document.getElementById(id);
        if (!el) return;
        const update = () => updatePreview();
        el.addEventListener('input', update);
        el.addEventListener('change', update);
      });
      // initial update
      updatePreview();
    });

    function updatePreview() {
      const title = document.getElementById('eventName').value || 'Event Title';
      const desc = document.getElementById('eventDescription').value || 'Short description will appear here as you type.';
      const date = document.getElementById('eventDate').value;
      const time = document.getElementById('eventTime').value;
      const loc = document.getElementById('eventLocation').value || 'Location';
      const previewTitle = document.getElementById('previewTitle');
      const previewDesc = document.getElementById('previewDesc');
      const previewDateLoc = document.getElementById('previewDateLoc');
      const bannerSelect = document.getElementById('eventBanner');

      previewTitle.textContent = title;
      previewDesc.textContent = desc.length > 220 ? desc.slice(0,217) + '...' : desc;
      let dateText = '';
      if (date) {
        try { dateText = new Date(date).toDateString(); } catch(e) { dateText = date; }
      }
      const timeText = time ? time : '';
      previewDateLoc.textContent = [dateText, timeText, loc].filter(Boolean).join(' Â· ');

      // update banner image if selected
      const previewImage = document.getElementById('previewImage');
      if (bannerSelect && bannerSelect.value) {
        previewImage.src = bannerSelect.value;
        previewImage.style.display = 'block';
      }
    }
  </script>

  <!-- Firebase + Auth -->
  <script type="module" src="../../Shared/firebase-config.js"></script>
  <script type="module" src="../../js/Registration/auth.js"></script>

  <!-- Combined Events Script -->
  <script type="module" src="../../js/Events/events.js"></script>
</body>
</html>
