<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Event Details</title>
  <link rel="icon" type="image/png" href="evently_logo_DT.png">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Montserrat', Arial, sans-serif;
      background: linear-gradient(135deg, #367bfc 0%, #002976 100%);
      margin: 0; padding: 0;
    }
    .toolbar {
      width: 100%; background: rgba(0,51,102,0.95);
      color: #fff; display: flex; align-items: center;
      padding: 0 32px; height: 72px; box-shadow: 0 4px 16px rgba(0,0,0,0.12);
    }
    .toolbar-logo { height: 48px; margin-right: 36px; cursor: pointer; }
    .toolbar-btn { background: rgba(255,255,255,0.08); border: none; color: #fff; padding: 10px 22px; margin-right: 20px; border-radius: 6px; cursor: pointer; }
    .container { max-width: 900px; margin: 48px auto; background: #fff; border-radius: 12px; padding: 36px; box-shadow: 0 8px 24px rgba(0,0,0,0.1); }
    .event-image { width: 100%; height: 340px; object-fit: cover; border-radius: 12px; margin-bottom: 24px; }
    .event-title { font-size: 2em; color: #002976; margin-bottom: 12px; }
    .event-date-location { color: #367bfc; font-size: 1.1em; margin-bottom: 16px; }
    .event-description { font-size: 1.05em; color: #333; background: rgba(54,123,252,0.05); padding: 16px; border-radius: 8px; }
    .buy-ticket-btn { background: linear-gradient(90deg, #0078d4 60%, #367bfc 100%); color: #fff; border: none; border-radius: 8px; padding: 14px 28px; font-size: 1.1em; cursor: pointer; margin-top: 20px; margin-right: 12px; }
  </style>
</head>
<body>

  <div class="toolbar">
    <img src="evently_logo_DT.png" alt="Logo" class="toolbar-logo" onclick="location.href='organizer-dashboard.html'">
    <button class="toolbar-btn" onclick="location.href='organizer-dashboard.html'">Home</button>
    <button class="toolbar-btn" onclick="location.href='eventCreation.html'">Create Event</button>
  </div>

  <div class="container">
    <img id="eventBanner" src="https://via.placeholder.com/900x340" class="event-image" alt="Event Banner">
    <h1 class="event-title">Loading...</h1>
    <div class="event-date-location"></div>
    <div class="event-description">Loading event details...</div>
   <button class="buy-ticket-btn" onclick="location.href='eventEdit.html?id=' + new URLSearchParams(window.location.search).get('id')">
  Edit Event
</button>
    <button class="buy-ticket-btn" onclick="location.href='scanTicket.html'">Scan Ticket</button>
    <button class="buy-ticket-btn" onclick="location.href='../EventAnalytics/script/EventDashboard.html'">View Analytics</button>
  </div>

  <!-- Firebase + Auth -->
  <script type="module" src="../Shared/firebase-config.js"></script>
  <script type="module" src="../Registration/scripts/auth.js"></script>

  <!-- Load Event Details -->
  <script type="module">
  import { auth, db } from "../Shared/firebase-config.js";
  import { doc, getDoc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";
  import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";

  const params = new URLSearchParams(window.location.search);
  const eventId = params.get("id");

  const titleEl = document.querySelector(".event-title");
  const descEl = document.querySelector(".event-description");
  const dateLocEl = document.querySelector(".event-date-location");
  const bannerEl = document.getElementById("eventBanner");

  const editBtn = document.querySelector('.buy-ticket-btn:nth-of-type(1)');
  const scanBtn = document.querySelector('.buy-ticket-btn:nth-of-type(2)');
  const analyticsBtn = document.querySelector('.buy-ticket-btn:nth-of-type(3)');

  async function loadEventDetails(user) {
    if (!eventId) {
      titleEl.textContent = "Event not found.";
      return;
    }

    const docRef = doc(db, "events", eventId);
    const snap = await getDoc(docRef);

    if (!snap.exists()) {
      titleEl.textContent = "Event not found.";
      descEl.textContent = "";
      return;
    }

    const data = snap.data();
    titleEl.textContent = data.eventName || "Untitled Event";
    descEl.innerHTML = data.eventDescription || "No description available.";

    const dateObj = data.eventDateTime?.toDate?.();
    const dateStr = dateObj ? dateObj.toDateString() : "Unknown date";
    dateLocEl.innerHTML = `
      <span>${dateStr}</span><br>
      <span>${data.eventLocation || "Unknown location"}</span>
    `;

    if (data.eventBannerURL) bannerEl.src = data.eventBannerURL;

    // ðŸš« Hide organizer-only buttons if not owner
    if (!user || user.uid !== data.createdBy) {
      editBtn.style.display = "none";
      scanBtn.style.display = "none";
      analyticsBtn.style.display = "none";
    } else {
      // âœ… Organizer can edit, scan, view analytics
      editBtn.onclick = () => location.href = `eventEdit.html?id=${eventId}`;
      scanBtn.onclick = () => location.href = `scanTicket.html?id=${eventId}`;
      analyticsBtn.onclick = () => location.href = `../EventAnalytics/script/EventDashboard.html?id=${eventId}`;
    }
  }

  // Wait for auth to load, then fetch event
  onAuthStateChanged(auth, (user) => {
    loadEventDetails(user);
  });
</script>


</body>
</html>
